<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/seedrandom/3.0.5/seedrandom.min.js"></script>
    <script>
      var is_dragging = false;
      var lastMouseX = null;
      var lastMouseY = null;
      var mainSvgX = 0;
      var mainSvgY = 0;
      var zoomScale = 1.0;
      var mainSvgElem = null;
      var mapPortDiv = null;

      function port_coord_to_world(p) {
          return p.add(new Point(mainSvgX, mainSvgY)).scale(zoomScale);
      }

      function set_transform() {
          mainSvgElem.style.transform = `translate(${mainSvgX}px, ${mainSvgY}px) scale(${zoomScale})`;
          add_needed_tiles();
      }

      function setup_scroll_and_zoom() {
          mainSvgElem = document.getElementById("mainsvg");
          mapPortDiv = document.getElementById("mapport");
          mapPortDiv.addEventListener("mousedown", function(e){
              is_dragging = true;
              lastMouseX = e.clientX;
              lastMouseY = e.clientY;
          });
          mapPortDiv.addEventListener("mouseup", function(){
              is_dragging = false;
          });
          mapPortDiv.addEventListener("mousemove", function(e){
              if (!is_dragging) return;
              e.preventDefault();
              var dx = e.clientX - lastMouseX;
              var dy = e.clientY - lastMouseY;
              mainSvgX += dx;
              mainSvgY += dy;
              lastMouseX = e.clientX;
              lastMouseY = e.clientY;
              set_transform();
          });
          mapPortDiv.addEventListener("wheel", function(e){
              e.preventDefault();
              var zoomChange = Math.exp(e.deltaY * -0.001);
              var rect = mapPortDiv.getBoundingClientRect();
              var xInPort = e.clientX - rect.left;
              var yInPort = e.clientY - rect.top;
              mainSvgX = xInPort - (xInPort - mainSvgX) * zoomChange;
              mainSvgY = yInPort - (yInPort - mainSvgY) * zoomChange;
              zoomScale *= zoomChange;
              set_transform();
          });
      }

      var tileTemplateGs = null;
      var tileWidth = 10000;
      var tileHeight = 10000;

      function modulo(n, m) {
          return ((n % m) + m) % m;
      }

      function some_random(i, j) {
          return (new Math.seedrandom(i + "aa" + j))();
      }

      function add_tile_if_not_there(i, j) {
          var id = `Tile_${i}_${j}`;
          if (!document.getElementById(id)) {
              var kind = Math.floor(some_random(i, j) * tileTemplateGs.length);
              var newTileG = tileTemplateGs[kind].cloneNode(true);
              newTileG.id = id;
              newTileG.style.transform = `translate(${i*tileWidth}px, ${j*tileHeight}px)`;
              document.getElementById("Tiles").appendChild(newTileG);
          }
      }

      function add_needed_tiles() {
          var start_i = Math.floor(-mainSvgX / zoomScale / tileWidth);
          var start_j = Math.floor(-mainSvgY / zoomScale / tileHeight);
          var end_i = Math.ceil((mapPortDiv.clientWidth - mainSvgX) / zoomScale / tileWidth);
          var end_j = Math.ceil((mapPortDiv.clientHeight - mainSvgY) / zoomScale / tileHeight);
          for (var i = start_i; i < end_i; i++) {
              for (var j = start_j; j < end_j; j++) {
                  add_tile_if_not_there(i, j);
              }
          }
      }

      function setup_tiles() {
          var tileTemplatesG = document.getElementById("TileTemplates");
          document.getElementById("mainsvg").removeChild(tileTemplatesG);
          tileTemplateGs = [];
          for (var i = 0; i < tileTemplatesG.children.length; i++) {
              var tile = tileTemplatesG.children[i];
              for (var c = 0; c < tile.getAttribute("data-freq"); c++) {
                  // push mulitple times (without copying) to increase its chances of being picked
                  tileTemplateGs.push(tile);
              }
          }
      }

      function init() {
          setup_scroll_and_zoom();
          setup_tiles();
          set_transform();
      }

    </script>

    <style>
      #mapport {
          position: fixed;
          top: 20px;
          left: 20px;
          bottom: 20px;
          right: 20px;
          overflow: hidden;
          background-color: white;
      }

      #mainsvg {
          position: absolute;
           /* show elements at negative positions too, we want an infinite space in all directions */
          overflow: visible;
          top: 0;
          left: 0;
          transform-origin: top left;
      }

      body {
          background-color: #555;
      }
    </style>
  </head>

  <body onload="init()">
    <div id="mapport">
      <svg id="mainsvg" width="42" height="42"> <!-- width and height are ignored because overflow:visible -->

        <defs>
          <linearGradient id="WhiteToBlueGradient">
            <stop offset="5%" stop-color="white"/>
            <stop offset="95%" stop-color="blue"/>
          </linearGradient>

          <pattern id="BlueCircles" x="0" y="0" width="50" height="50" patternUnits="userSpaceOnUse">
            <rect x="0" y="0" width="50" height="50" fill="skyblue"/>
            <circle cx="25" cy="25" r="20" fill="url(#WhiteToBlueGradient)" fill-opacity="0.5"/>
          </pattern>

          <pattern id="SimpleBlueCircles" x="0" y="0" width="40" height="40" patternUnits="userSpaceOnUse">
            <circle cx="20" cy="20" r="20" fill="#64bee3" />
          </pattern>

          <pattern id="CobbledWestEast" x="0" y="0" width="40" height="40" patternUnits="userSpaceOnUse">
            <rect x="2" y="2" width="16" height="36" fill="#dddddd"/>
            <rect x="22" y="0" width="16" height="18" fill="#dddddd"/>
            <rect x="22" y="22" width="16" height="18" fill="#dddddd"/>
          </pattern>

          <pattern id="SquareWaveCobble" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
            <rect x="0" y="0" width="20" height="20" fill="#dddddd"/>
            <path d="M 10 0 l -2 5 l 4 10 l -2 5 M 0 10 l 5 2 l 10 -4 l 5 2"
                  stroke="#999999" stroke-width="1"
                  stroke-linejoin="round" stroke-linecap="round" fill="transparent"/>
          </pattern>

          <pattern id="Tiles1" x="0" y="0" width="150" height="150" patternUnits="userSpaceOnUse">
            <rect x="2"   y="2"   width="56" height="56" fill="#f3f3f3"/>
            <rect x="62"  y="32"  width="56" height="56" fill="#f3f3f3"/>
            <rect x="122" y="62"  width="56" height="56" fill="#f3f3f3"/>
            <rect x="-28" y="62"  width="56" height="56" fill="#f3f3f3"/>
            <rect x="32"  y="92"  width="56" height="56" fill="#f3f3f3"/>
            <rect x="92"  y="122" width="56" height="56" fill="#f3f3f3"/>
            <rect x="92"  y="-28" width="56" height="56" fill="#f3f3f3"/>
            <rect x="62"  y="2"   width="26" height="26" fill="#dddddd"/>
            <rect x="122" y="32"  width="26" height="26" fill="#dddddd"/>
            <rect x="32"  y="62"  width="26" height="26" fill="#dddddd"/>
            <rect x="92"  y="92"  width="26" height="26" fill="#dddddd"/>
            <rect x="2"   y="122" width="26" height="26" fill="#dddddd"/>
          </pattern>

          <pattern id="BlueCarpet1" x="0" y="0" width="12" height="12" patternUnits="userSpaceOnUse">
            <rect x="0" y="0" width="12" height="12" fill="#174062"/>
            <circle cx="3" cy="3" r="4.243" fill="#555555"/>
            <circle cx="9" cy="9" r="4.243" fill="#555555"/>
          </pattern>

          <pattern id="Lawn1" x="0" y="0" width="5" height="5" patternUnits="userSpaceOnUse">
            <rect x="0" y="0" width="5" height="5" fill="#56b000"/>
            <circle cx="-2" cy="0" r="5" stroke-width="1" stroke="#63c900" fill="none"/>
          </pattern>

          <pattern id="Ocean" x="0" y="0" width="80" height="40" patternUnits="userSpaceOnUse">
            <rect x="0" y="0" width="80" height="40" fill="#4dc3ff"/>
            <path d="M 3 9 c 6 -6, 11 -6, 17 0 s 11 6, 17 0"
                  stroke-width="4" stroke="#b3e6ff" stroke-linecap="round" fill="transparent"/>
            <path d="M 43 29 c 6 -6, 11 -6, 17 0 s 11 6, 17 0"
                  stroke-width="4" stroke="#b3e6ff" stroke-linecap="round" fill="transparent"/>
          </pattern>

          <clipPath id="ClipMapTile">
            <rect x="0" y="0" width="10020" height="10000"/>
          </clipPath>
        </defs>

        <g id="TileTemplates">
          <!-- four sand corners -->
          <g data-freq="10" clip-path="url(#ClipMapTile)" transform="translate(-10000, 0)">
            <rect x="0" y="0" width="10000" height="10000" fill="url(#Ocean)" />
            <ellipse cx="10000" cy="10000" rx="5000" ry="2500" fill="#cccc00"/>
            <circle cx="0" cy="0" r="3500" fill="#cccc00"/>
            <ellipse cx="0" cy="10000" rx="3500" ry="2500" fill="#cccc00"/>
            <ellipse cx="10000" cy="0" rx="5000" ry="3500" fill="#cccc00"/>
          </g>
          <!-- filled with one little lake per edge -->
          <g data-freq="2" clip-path="url(#ClipMapTile)" transform="translate(0,0)">
            <rect x="0" y="0" width="10000" height="10000" fill="#cccc00" />
            <ellipse cx="4250" cy="0" rx="750" ry="600" fill="url(#Ocean)"/>
            <ellipse cx="4250" cy="10000" rx="750" ry="500" fill="url(#Ocean)"/>
            <ellipse cx="10000" cy="5500" rx="1800" ry="2000" fill="url(#Ocean)"/>
            <ellipse cx="0" cy="5500" rx="1200" ry="2000" fill="url(#Ocean)"/>
          </g>
          <!-- water shaped like -| -->
          <g data-freq="3" clip-path="url(#ClipMapTile)" transform="translate(0, -10000)">
            <rect x="0" y="0" width="10000" height="7500" fill="url(#Ocean)" />
            <rect x="0" y="7500" width="10000" height="2500" fill="#cccc00" />
            <path d="M 0 7500 q 1000 0, 2125 500 t 2125 500 t 2000 -500 t 3750 -500 L 0 7500"
                  fill="url(#Ocean)"/>
            <ellipse cx="10000" cy="4250" rx="1500" ry="3250" fill="url(#Ocean)"/>
            <circle cx="0" cy="0" r="3500" fill="#cccc00"/>
            <ellipse cx="10000" cy="0" rx="5000" ry="3500" fill="#cccc00"/>
            <ellipse cx="4250" cy="10000" rx="750" ry="600" fill="url(#Ocean)"/>
          </g>
          <!-- water shaped like upside down T -->
          <g data-freq="4" clip-path="url(#ClipMapTile)" transform="translate(-10000, -10000)">
            <rect x="0" y="0" width="5000" height="10000" fill="url(#Ocean)" />
            <rect x="5000" y="0" width="5000" height="10000" fill="#cccc00" />
            <path d="M 5000 0 q 0 1500, 1000 2750 t 1000 2750 t -1000 2250 t -1000 2250 L 5000 0"
                  fill="url(#Ocean)"/>
            <ellipse cx="10000" cy="5500" rx="1500" ry="2000" fill="url(#Ocean)"/>
            <circle cx="0" cy="0" r="3500" fill="#cccc00"/>
            <ellipse cx="0" cy="10000" rx="3500" ry="2500" fill="#cccc00"/>
          </g>
        </g>

        <g id="Tiles"/>

        <circle cx="250" cy="50" r="40" stroke="green" stroke-width="4" fill="yellow" />

        <circle cx="500" cy="9000" r="40" stroke="green" stroke-width="4" fill="white" />

        <rect x="110" y="90" width="200" height="200" fill="url(#SimpleBlueCircles)" fill-opacity="0.5"/>

        <rect x="520" y="20" fill="url(#BlueCircles)" width="500" height="500" fill-opacity="0.5"/>

        <rect x="45" y="325" fill="url(#CobbledWestEast)" width="400" height="200"/>

        <rect x="-1000" y="550" width="858" height="1000" fill="url(#Lawn1)"/>
        <rect x="-1000" y="940" width="850" height="200" fill="url(#SquareWaveCobble)"/>

        <rect x="-138" y="550" fill="url(#Tiles1)" width="700" height="1000"/>
        <rect x="-160" y="550" width="20" height="1000" fill="url(#CobbledWestEast)"/>

        <rect x="300" y="550" width="400" height="1000" rx="9" ry="9" stroke="white" stroke-width="4"fill="url(#BlueCarpet1)"/>


      </svg>
    </div>
  </body>
</html>
